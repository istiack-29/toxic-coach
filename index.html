<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    <title>Toxic Jailer Native</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Using System-Native Font Stacks 
           Bangla: Priority to Noto Sans Bengali (Android Default) and Kohinoor (iOS/High-end Android)
           English: Priority to System UI (Roboto/Inter)
        */
        :root {
            --font-stack: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans Bengali", "Kohinoor Bangla", sans-serif;
        }

        body {
            font-family: var(--font-stack);
            background-color: #000;
            color: #fff;
            margin: 0;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* Smoothing for Bangla glyphs */
        p, h1, h2, h3, button {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        /* Permission Gatekeeper Screen */
        #permission-gate {
            position: fixed;
            inset: 0;
            background: #000;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            padding: 40px 24px;
        }

        .permission-card {
            background: #111113;
            border-radius: 24px;
            padding: 20px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid #1c1c1e;
            transition: all 0.3s ease;
        }

        .permission-card.granted {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.05);
        }

        #native-notif-ui {
            position: fixed;
            top: -200px;
            left: 12px;
            right: 12px;
            background: rgba(28, 28, 30, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 28px;
            z-index: 11000;
            padding: 20px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.7);
            transition: transform 0.6s cubic-bezier(0.2, 1, 0.2, 1);
        }

        #native-notif-ui.active { transform: translateY(215px); }

        .jail-ui {
            position: fixed;
            inset: 0;
            background: #000;
            z-index: 9000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .pulse-loader {
            width: 12px;
            height: 12px;
            background: #3b82f6;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(3); opacity: 0; }
        }
    </style>
</head>
<body>

    <!-- 1. SYSTEM PERMISSION GATE -->
    <div id="permission-gate">
        <header class="mb-10">
            <div class="flex items-center gap-3 mb-4">
                <div class="w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center text-2xl">üõ°Ô∏è</div>
                <h1 class="text-2xl font-black uppercase tracking-tighter">System Setup</h1>
            </div>
            <p class="text-zinc-500 text-sm leading-relaxed">Toxic Jailer requires deep system access to lock your phone and prevent wastage.</p>
        </header>

        <div class="flex-1">
            <div id="card-notif" class="permission-card">
                <div>
                    <h3 class="font-bold text-white">System Notifications</h3>
                    <p class="text-[10px] text-zinc-500">To send alerts when you waste time</p>
                </div>
                <button onclick="reqNotif()" id="btn-notif" class="bg-blue-600 px-4 py-2 rounded-xl text-[11px] font-black uppercase">Allow</button>
            </div>

            <div id="card-overlay" class="permission-card">
                <div>
                    <h3 class="font-bold text-white">Draw Over Apps</h3>
                    <p class="text-[10px] text-zinc-500">Necessary to block TikTok/FB during study</p>
                </div>
                <button onclick="triggerHaptic(); alert('Find Toxic Jailer and enable Display Over Other Apps in settings.')" class="bg-zinc-800 px-4 py-2 rounded-xl text-[11px] font-black uppercase tracking-widest">Enable</button>
            </div>

            <div id="card-battery" class="permission-card">
                <div>
                    <h3 class="font-bold text-white">Ignore Battery Saver</h3>
                    <p class="text-[10px] text-zinc-500">Ensures the jailer doesn't sleep</p>
                </div>
                <button onclick="triggerHaptic(); alert('Set Battery Optimization to: Not Optimized')" class="bg-zinc-800 px-4 py-2 rounded-xl text-[11px] font-black uppercase tracking-widest">Exempt</button>
            </div>
        </div>

        <div class="mt-8 flex flex-col gap-4">
            <div class="flex items-center justify-center gap-2 text-zinc-600 mb-2">
                <div class="pulse-loader"></div>
                <span class="text-[10px] font-bold uppercase tracking-widest">Checking Hardware...</span>
            </div>
            <button id="system-start-btn" onclick="initializeSystem()" class="w-full py-6 bg-white text-black rounded-[30px] font-black text-lg opacity-40 pointer-events-none transition-all">INITIALIZE JAILER</button>
        </div>
    </div>

    <!-- 2. NATIVE NOTIFICATION COMPONENT -->
    <div id="native-notif-ui">
        <div class="flex items-center gap-4">
            <div class="w-12 h-12 bg-red-600 rounded-2xl flex items-center justify-center text-2xl">ü§°</div>
            <div class="flex-1">
                <p class="text-[10px] font-black text-zinc-500 uppercase tracking-widest">Wastage Alert</p>
                <p class="font-bold text-white text-sm" id="nt-title">‡¶∏‡¶Æ‡ßü ‡¶®‡¶∑‡ßç‡¶ü ‡¶π‡¶ö‡ßç‡¶õ‡ßá!</p>
            </div>
        </div>
        <p class="text-xs text-zinc-400 mt-3 mb-5 px-1" id="nt-body">‡¶§‡ßÅ‡¶á ‡¶è‡¶ñ‡¶® ‡¶´‡¶æ‡¶≤‡¶§‡ßÅ ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶õ‡¶ø‡¶∏‡•§ ‡¶è‡¶ñ‡¶®‡¶á ‡¶™‡ßú‡¶æ‡¶∂‡ßã‡¶®‡¶æ‡ßü ‡¶Æ‡¶® ‡¶¶‡ßá‡•§</p>
        <div class="flex gap-2">
            <button onclick="dismissNotif()" class="flex-1 py-3 bg-zinc-900 rounded-xl text-[10px] font-black uppercase text-zinc-500">Dismiss</button>
            <button onclick="dismissNotif(); enterJail();" class="flex-1 py-3 bg-blue-600 rounded-xl text-[10px] font-black uppercase">Lock Phone</button>
        </div>
    </div>

    <!-- 3. MAIN UI -->
    <div id="main-app" class="p-6 opacity-0 transition-opacity duration-1000 pointer-events-none">
        <header class="flex justify-between items-center mt-6 mb-10">
            <div>
                <p id="system-clock" class="text-2xl font-black text-zinc-700">00:00</p>
                <h1 class="text-3xl font-bold tracking-tighter">‡¶ü‡¶ï‡ßç‡¶∏‡¶ø‡¶ï ‡¶ú‡ßá‡¶≤‡¶æ‡¶∞</h1>
            </div>
            <button onclick="toggleChart(true)" class="w-14 h-14 bg-zinc-900 rounded-full flex items-center justify-center">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2.5"><path d="M12 20V10M18 20V4M6 20v-4"/></svg>
            </button>
        </header>

        <div class="grid grid-cols-2 gap-4 mb-8">
            <div class="bg-zinc-950 border border-zinc-900 p-6 rounded-[32px]">
                <p class="text-[10px] font-black text-zinc-600 uppercase mb-2">Life Points</p>
                <p id="disp-study" class="text-2xl font-black text-blue-500">00:00:00</p>
            </div>
            <div class="bg-zinc-950 border border-zinc-900 p-6 rounded-[32px]">
                <p class="text-[10px] font-black text-zinc-600 uppercase mb-2">Wasted</p>
                <p id="disp-waste" class="text-2xl font-black text-red-600">00:00:00</p>
            </div>
        </div>

        <button onclick="enterJail()" class="w-full py-12 bg-white text-black rounded-[40px] text-3xl font-black active:scale-95 transition-all">‡¶™‡ßú‡¶§‡ßá ‡¶¨‡¶∏ ‡¶π‡¶æ‡¶∞‡¶æ‡¶Æ‡¶ø!</button>
        
        <div class="flex gap-3 mt-4">
            <button onclick="setMode('care')" id="m-care" class="flex-1 py-6 bg-zinc-900 rounded-3xl text-[10px] font-black uppercase">Care</button>
            <button onclick="setMode('org')" id="m-org" class="flex-1 py-6 bg-zinc-900 rounded-3xl text-[10px] font-black uppercase">Org</button>
            <button onclick="setMode('fun')" id="m-fun" class="flex-1 py-6 bg-zinc-900 rounded-3xl text-[10px] font-black uppercase">Fun</button>
        </div>
    </div>

    <!-- 4. NATIVE JAIL OVERLAY -->
    <div id="jail-screen" class="jail-ui">
        <div id="jail-timer" class="text-[140px] font-black text-white leading-none">00:00</div>
        <p class="text-blue-600 text-xs font-black uppercase tracking-[0.5em] mt-10">System is Locked</p>
        <button onclick="exitJail()" class="absolute bottom-20 px-10 py-5 bg-zinc-950 border border-zinc-900 text-zinc-800 rounded-full font-black text-[10px] uppercase">EXIT JAIL (LOSER)</button>
    </div>

    <script>
        const STORAGE_KEY = 'native_jailer_v16';
        let wakeLock = null;
        let lastNotifTime = 0;

        let state = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
            setupComplete: false,
            lifetime: 0, dailyStudy: 0, dailyWaste: 0,
            lastDate: new Date().toLocaleDateString(),
            mode: 'waste'
        };

        function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

        async function reqNotif() {
            const res = await Notification.requestPermission();
            if (res === 'granted') {
                document.getElementById('card-notif').classList.add('granted');
                document.getElementById('btn-notif').innerText = 'Granted';
                document.getElementById('btn-notif').disabled = true;
                checkReady();
            }
        }

        function checkReady() {
            if (Notification.permission === 'granted') {
                document.getElementById('system-start-btn').classList.remove('opacity-40', 'pointer-events-none');
            }
        }

        function initializeSystem() {
            state.setupComplete = true;
            save();
            document.getElementById('permission-gate').style.display = 'none';
            document.getElementById('main-app').style.opacity = '1';
            document.getElementById('main-app').style.pointerEvents = 'all';
        }

        function triggerHaptic(strong = false) {
            if (navigator.vibrate) navigator.vibrate(strong ? [100, 50, 100] : [25]);
        }

        async function requestWakeLock() {
            try { if ('wakeLock' in navigator) wakeLock = await navigator.wakeLock.request('screen'); } catch (e) {}
        }

        function showSystemNotif() {
            if (document.getElementById('jail-screen').style.display === 'flex') return;
            const msgs = [
                { t: "‡¶™‡ßú‡¶§‡ßá ‡¶¨‡¶∏ ‡¶π‡¶æ‡¶∞‡¶æ‡¶Æ‡¶ø!", b: "‡¶∏‡¶Æ‡ßü ‡¶®‡¶∑‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ì‡¶∏‡ßç‡¶§‡¶æ‡¶¶ ‡¶§‡ßÅ‡¶á‡•§ ‡¶´‡ßã‡¶®‡ßá‡¶∞ ‡¶Æ‡¶æ‡ßü‡¶æ ‡¶õ‡¶æ‡ßú‡•§" },
                { t: "‡¶ï‡¶∑‡ßç‡¶ü ‡¶π‡¶¨‡ßá ‡¶ú‡¶æ‡¶®‡¶ø...", b: "‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶è‡¶ñ‡¶® ‡¶®‡¶æ ‡¶™‡ßú‡¶≤‡ßá ‡¶∏‡¶æ‡¶∞‡¶æ‡¶ú‡ßÄ‡¶¨‡¶® ‡¶ï‡¶æ‡¶®‡ßç‡¶¶‡¶æ ‡¶≤‡¶æ‡¶ó‡¶¨‡ßá‡•§" }
            ];
            const m = msgs[Math.floor(Math.random()*msgs.length)];
            document.getElementById('nt-title').innerText = m.t;
            document.getElementById('nt-body').innerText = m.b;
            
            triggerHaptic(true);
            document.getElementById('native-notif-ui').classList.add('active');
            setTimeout(dismissNotif, 8000);
        }

        function dismissNotif() { document.getElementById('native-notif-ui').classList.remove('active'); }

        function enterJail() {
            triggerHaptic(true);
            requestWakeLock();
            document.getElementById('jail-screen').style.display = 'flex';
            document.getElementById('main-app').classList.add('hidden');
            state.mode = 'study';
            save();
        }

        function exitJail() {
            if (confirm("‡¶§‡ßÅ‡¶á ‡¶ï‡¶ø ‡¶≤‡ßú‡¶æ‡¶ï‡ßÅ ‡¶®‡¶æ ‡¶ï‡¶ø ‡¶≤‡ßÅ‡¶ú‡¶æ‡¶∞? ‡¶ö‡¶≤‡ßá ‡¶Ø‡¶æ‡¶¨‡¶ø?")) {
                if (wakeLock) wakeLock.release();
                document.getElementById('jail-screen').style.display = 'none';
                document.getElementById('main-app').classList.remove('hidden');
                state.mode = 'waste';
                save();
            }
        }

        function updateSystem() {
            const now = new Date();
            const h = now.getHours();
            document.getElementById('system-clock').innerText = now.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });

            const isSleep = (h >= 22 || h < 5);
            const isStudying = (document.getElementById('jail-screen').style.display === 'flex' || state.mode === 'study');

            if (isStudying) {
                state.dailyStudy++;
                state.lifetime++;
            } else if (!isSleep) {
                state.dailyWaste++;
                if (Date.now() - lastNotifTime > 600000) {
                    showSystemNotif();
                    lastNotifTime = Date.now();
                }
            }
            refreshUI();
        }

        function refreshUI() {
            const f = (s) => {
                const hrs = Math.floor(s/3600), m = Math.floor((s%3600)/60), sc = s%60;
                return `${hrs.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${sc.toString().padStart(2,'0')}`;
            };
            document.getElementById('disp-study').innerText = f(state.dailyStudy);
            document.getElementById('disp-waste').innerText = f(state.dailyWaste);
            if (document.getElementById('jail-screen').style.display === 'flex') {
                const mins = Math.floor(state.dailyStudy / 60) % 60;
                const secs = state.dailyStudy % 60;
                document.getElementById('jail-timer').innerText = `${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;
            }
        }

        function setMode(m) {
            state.mode = m;
            triggerHaptic();
            ['care', 'org', 'fun'].forEach(id => {
                const el = document.getElementById(`m-${id}`);
                el.style.borderColor = (m === id) ? '#3b82f6' : 'transparent';
                el.style.background = (m === id) ? '#111' : '#0a0a0c';
            });
            save();
        }

        window.onload = () => {
            if (state.setupComplete) {
                document.getElementById('permission-gate').style.display = 'none';
                document.getElementById('main-app').style.opacity = '1';
                document.getElementById('main-app').style.pointerEvents = 'all';
            }
            setInterval(updateSystem, 1000);
            setMode(state.mode);
        };
    </script>
</body>
</html>

